<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Escapade 101</title>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="./styles/home.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Love+Ya+Like+A+Sister' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Waiting+for+the+Sunrise' rel='stylesheet' type='text/css'>
    <script src="js/underscore.js"></script>
    <script>
        var airports = {};

        $(document).ready(function() {
            $('input[type=radio][name=trip-type]').change(function() {
                var returnPicker = $("#return-container");
                if (this.value == 'round-trip') {
                    returnPicker.show();
                } else {
                    returnPicker.hide();
                }
            });
            $(".datepicker").datepicker();

            $("form").submit(function(event) {
                // Validate form
                var to = $("#to").val();
                var from = $("#from").val();
                var departDate = $("#depart-input").val();
                var returnDate = $("#return-input").val();
                var roundTrip = $('input[name="trip-type"]').val() === 'round-trip';

                var error;

                if (to == null || to === "") {
                    error = '"To" field is required';
                } else if (from == null || from === "") {
                    error = '"From" field is required';
                } else if (departDate == null || departDate === "") {
                    error = '"Departure Date" is required'
                } else if (roundTrip && (returnDate == null  || returnDate === "")) {
                    error = '"Return Date is required';
                } else if (_.keys(airports).indexOf(to) == -1) {
                    error = '"' + to + '" is not a valid airport identifier'
                } else if (_.keys(airports).indexOf(from) == -1) {
                    error = '"' + from + '" is not a valid airport identifier'
                } else if (new Date(departDate) - Date.now() < 0) {
                    error = 'Departure date "' + departDate + '" is in the past';
                } else if (roundTrip && (new Date(returnDate) - Date.now() < 0)) {
                    error = 'Return date "' + returnDate + '" is in the past';
                } else if (roundTrip && new Date(returnDate) - new Date(departDate) < 0) {
                    error = 'Return date must be after departure date';
                }

                if (error != null) {
                    $("#error").html(error);
                    event.preventDefault();
                }
            });
        });

        $.get("http://localhost:9000/airports", function (data) {
            console.log('done');
            airports = JSON.parse(data);
            $("#to, #from").autocomplete({
                source: _.map(airports, function(full, abbrev) {
                    return {label: full + ' (' + abbrev + ')', value: abbrev};
                })
            });
        });
    </script>
</head>
<body>
<header>
    <div id="travel-alerts" class="backWhite red alert">
        Flights to New York are delayed due to weather conditions
    </div>
    <div class="bgColor">
        <div class="header col-1">
            <div class="nav-div">
                <div id="logo">
                    <img class="logo-image" src="images/Picture2.png" alt="Escapade Logo"/>
                    <!--<img class="logo-image" alt="Escapade Logo"/>-->
                    <!--<span id="title">Vacation Planner</span>-->
                </div>
                <nav>
                    <div id="nav" class="nav">
                        <ul class="nav-links">
                            <li><a href="home.html" class="selected">
                                <input id="tab1" type="radio" name="tabs" checked>
                                <label for="tab1"> Flights</label>
                            </a></li>
                            <li><a href="rentals.html" class="selected">
                                <input id="tab2" type="radio" name="tabs" checked>
                                <label for="tab2"> Rentals</label>
                            </a></li>
                            <!--<li><a href="rentals.html"><span class="rentals">Rentals</span></a></li>-->
                            <!--<li><i class="fa fa-car"></i>&nbsp;<a href="rentals.html">Rentals</a></li>-->
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="col-2">
            <nav>
                <div id="right-nav" class="right-nav custom-dropdown">
                    <input type="checkbox" checked="false" id="button">
                    <label for="button"></label>
                    <ul class="right-nav-links">
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>
                        <li><a href="support.html">Support</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
</header>
<div id="section">
    <form action="flights.html">
        <div class="flex-container">
            <span id="plan-your-flight">Plan Your Flight!</span>
            <span id="error"></span>
            <div id="trip-type-container">
                <label class="radio-label input-label" for="round-trip">Round Trip</label>
                <input class="radio-input" id="round-trip" type="radio" name="trip-type" value="round-trip" checked/>
                <label class="radio-label input-label" for="one-way">One Way</label>
                <input class="radio-input" id="one-way" type="radio" name="trip-type" value="one-way"/>
            </div>

            <br style="clear:both;"/>

            <div id="trip-location-container">
                <div id="from-container">
                    <label class="input-label" for="from">From</label>
                    <input class="home-input" id="from" type="text" name="from" value=""/>
                </div>
                <div id="to-container">
                    <label class="input-label" for="to">To</label>
                    <input class="home-input" id="to" name="to" value=""/>
                </div>
            </div>

            <br style="clear:both;"/>

            <div id="trip-time-container">
                <div id="depart-container">
                    <label class="input-label" for="depart-input">Depart:</label>
                    <input class="home-input datepicker" id="depart-input" type="text" name="depart">
                </div>
                <div id="return-container">
                    <label class="input-label" for="return-input">Return:</label>
                    <input class="home-input datepicker" id="return-input" type="text" name="arrive">
                </div>
            </div>

            <br style="clear:both;"/>

            <div id="trip-passengers-container">
                <label id="adult-label" class="input-label" for="adults">Adults</label>
                <select id="adults" name="adults">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4+">4+</option>
                </select>
                <label id="children-label" class="input-label" for="children">Children</label>
                <select id="children" name="children">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4+">4+</option>
                </select>
            </div>

            <button id="search-flights" type="submit" name="submitButton" value="search-flights">Search Flights</button>
        </div>
    </form>
</div>
<footer>
    <div class="footer">
        <nav>
            <div class="footer-nav">
                <ul class="footer-nav-links">
                    <li><a href="aboutUs.html">About Us</a></li>
                    <li class="marginLeft"><a href="contactUs.html">Contact Us</a></li>
                </ul>
            </div>
        </nav>
        </br></br>
        <span class="grey">Â© 2016 All Rights Reserved</span>
    </div>
</footer>
</body>
</html>